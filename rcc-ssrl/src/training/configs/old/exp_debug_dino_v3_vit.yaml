# DINOv3 baseline config with ViT backbone
experiment:
  name: "exp_debug_dino_v3_vit"
  seed: 1337
  paper_tags: ["debug", "ssl_focus", "dino_v3", "vit"]
  validate:
    paths: true
    steps_per_epoch: true
    batch_sizes: true
  allow_cpu: false

model:
  ssl:
    name: dino_v3
    temp_student: 0.1
    temp_teacher: 0.04
    gram_lambda: 1.0
    center_momentum: 0.9
    teacher_temp_schedule:
      min: 0.04
      max: 0.07
      warmup_steps: 30000
  backbone: vit_small_patch16_224
  backbone_opts: {}

data:
  img_size: 224
  dino_v3:
    global_size: 224
    local_size: 96
    n_local: 6
    jitter: 0.4
    global_scale: [0.14, 1.0]
    local_scale: [0.05, 0.14]
    blur_prob: 0.5
    solarize_prob: 0.0
    solarize_prob_g2: 0.2

  webdataset:
    dataset_key: "rcc_v2"
    batch_size_ssl: 32
    batch_size_sl: 64
    num_workers: 8
    prefetch_factor: 4
    shuffle_shards: 128
    shuffle_samples: 4000
    samples_per_epoch: 320
    class_to_id:
      ccRCC: 0
      pRCC: 1
      CHROMO: 2
      ONCO: 3
      NOT_TUMOR: 4

train:
  optim:
    name: adamw
    lr: 0.0005
    weight_decay: 0.04
    betas: [0.9, 0.999]
    eps: 1e-8

  scheduler:
    name: cosine
  ssl:
    epochs: 2
    steps_per_epoch: 10
    ema_m: 0.996
    grad_clip_max: 3.0
    accumulate_steps: 1
    amp: true

# Logging
logging:
  log_every_steps: 100
  metrics_csv_name: "ssl_timeseries.csv"

# Top-level augmentations (stain + rotate90)
aug:
  base:
    rotate90: false
    hflip: true
    vflip: true
    random_resized_crop:
      scale: [0.6, 1.0]
      ratio: [0.75, 1.33]
    color_jitter:
      enable: false
      brightness: 0.4
      contrast: 0.4
      saturation: 0.2
      hue: 0.1
    grayscale_p: 0.2
    gaussian_blur_p: 0.2
    sharpen_p: 0.2
    jpeg_artifacts_p: 0.1
    solarize_p: 0.0

  stain:
    normalize:
      enable: false
      method: macenko
    jitter:
      enable: false
      delta: 0.02

# Tissue-aware sampling
sampler:
  tissue_aware:
    enable: false
    min_tissue_frac: 0.6
